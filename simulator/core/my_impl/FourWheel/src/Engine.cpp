#include <cmath>
#include "Engine.h"
using namespace std;
#include <iostream>

void Engine::EngineTor(double ped, double speed)
{
	const double map[20][11] =
	{ {-1, 0, 0.1, 0.15, 0.2, 0.35, 0.5, 0.7, 0.85, 0.95, 1 },
	{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
	{86.6667, 15, 64.064, 85.328, 87.064, 88.048, 88.536, 88.704, 88.744, 88.768, 88.744 },
	{ 173.333, 18, 78.176, 117.56, 125.544, 126.824, 127.344, 127.528, 127.544, 127.544, 127.544 },
	{433.333, 20, 59.448, 146.12, 167.224, 175.6, 178.464, 179.536, 179.632, 179.608, 179.536 },
	{750, 25, 39.66, 138.648, 172.668, 186.152, 191.204, 193.676, 194.252, 194.628, 194.892 },
	{866.667, 15, 35, 131.176, 178.112, 196.704, 203.944, 207.816, 208.872, 209.648, 210.248 },
	{1300, -16.976, -4.152, 99.032, 171.44, 207, 222.12, 228.256, 229.168, 229.552, 229.696 },
	{1733.33, -21.312, -5.392, 68.432, 153.264, 203.92, 224.744, 233.48, 235.048, 235.688, 235.904 },
	{2166.67, -25.368, -12.76, 47.48, 129.208, 196.232, 227.192, 240.088, 242.256, 243.152, 243.456 },
	{2600, -28.944, -18.568, 31.704, 103.104, 188.088, 235.224, 256.704, 260.488, 262.104, 262.664 },
	{3033.33, -32.464, -23.656, 19.768, 81.256, 169.224, 228.608, 258.416, 263.984, 266.424, 267.304 },
	{3466.67, -36, -28.376, 9.936, 64.328, 146.76, 209.28, 242.344, 248.584, 251.288, 252.232 },
	{3900, -39.736, -33.144, 0.232, 48.36, 126.464, 199.744, 241.768, 249.96, 253.6, 254.952 },
	{4333.33, -43.624, -37.888, -8.392, 34.672, 105.272, 185.448, 236.488, 247, 251.784, 253.6 },
	{4766.67, -47.76, -42.568, -16.064, 22.72, 86.408, 167.472, 224.528, 236.784, 242.456, 244.64 },
	{5200, -51.912, -47.344, -23.176, 12.16, 70.304, 148.64, 207.776, 220.816, 226.968, 229.368 },
	{5633.33, -56.56, -52.328, -30.064, 2.376, 55.72, 129.024, 186.376, 199.088, 205.056, 207.416 },
	{6066.67, -61.624, -57.584, -36.936, -6.872, 42.408, 109.984, 163.184, 175.016, 180.576, 182.704 },
	{6500, -61.6, -61.6, -61.6, -61.6, -61.6, -61.6, -61.6, -61.6, -61.6, -61.6} };
    
	if (speed > 6500)
	    speed = 6500;
	else if (speed<800)
		speed = 800;
	//if (speed > 6066.67) {
	//	std::cout << "speed > 6500" << std::endl;
	//	throw "ped > 6066.67";
	//}
	//if (speed < 500) {
	//	std::cout << "speed < 500" << std::endl;
	//	throw "speed < 500";
	//}
	
	int i = 0;

	for (i=0; i < 11; i++)
	{
		if (ped <= map[0][i])
			break;
	}

	int k = 0;

	for (k=0; k < 20; k++)
		if (speed <= map[k][0])
			break;

	double midnum1, midnum2, finnum;

	

	midnum1 = (map[k][i] - map[k][i - 1]) / (map[0][i] - map[0][i - 1]) * (ped - map[0][i - 1]) + map[k][i - 1];
	midnum2 = (map[k - 1][i] - map[k - 1][i - 1]) / (map[0][i] - map[0][i - 1]) * (ped - map[0][i - 1]) + map[k - 1][i - 1];
	finnum = (midnum1 - midnum2) / (map[k][0] - map[k - 1][0]) * (speed - map[k - 1][0]) + midnum2;

	Torq=finnum;
	//cout << "Torq  "<<Torq << endl;
}
